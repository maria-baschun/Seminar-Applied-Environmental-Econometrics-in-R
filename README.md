
# README: Estimation of ATT Using Emission and Real Estate Data

## Step 1: Download and Prepare Datasets and Model Files

### Required Files:
1. **Emissions Data**  
   - File: `2023-12-08_PRTR-Deutschland_Freisetzungen.xlsx`  
   - Source: [THRU Downloads](https://thru.de/downloads)  
   - Instructions:  
     - Download the ZIP folder labeled *"PRTR-Gesamtdatenbestand 2007 bis 2022"* as a Microsoft Excel workbook (`*.xlsx`).  
     - Export the file and locate the desired dataset. Use the version with the published date 13.11.2023 (see the ‚ÄúDatum‚Äù column on the website).

2. **Real Estate Data**  
   - Files:  
     - `CampusFile_WK_cities.csv`  
     - `number_observations_panel.xlsx`  
   - Source: [RWI-GEO-RED Panel Campus File](https://www.rwi-essen.de/forschung-beratung/weitere/forschungsdatenzentrum-ruhr/datenangebot/rwi-geo-red-real-estate-data)  
   - Instructions:  
     - This dataset provides property locations at a 1 km¬≤ grid level for Germany's 15 largest cities (2007‚Äì2021).  
     - Request access from the RWI or your institution's statistics department.  
     - Only the data for **apartments** and the **small dataset on the number of observations** are required. Exclude the data on houses for sale and rental data. Save them as:  
       - `CampusFile_WK_cities.csv`  
       - `number_observations_panel.xlsx`

3. **Propensity Score from Fitted Logistic Model**  
   - File: `PS.rds`  
   - Source: Provided in this GitHub repository.  
   - Note: If you prefer to refit the logistic model for propensity score estimation and estimate the PS again:  
     - Uncomment lines 87‚Äì98 in `estimation.R`.  
     - Be aware that fitting the model can take **up to 8 hours**.  
     - The refitted model and the reestimated PS will be saved automatically as `logit_model.rds` and `PS.rds` in your working directory.

---

## Step 2: Load the Data
- Open `data_loading.R`.  
- Update the **working directory** (line 21) to the folder where the downloaded files are saved.  
- Run the script to load the data.

---

## Step 3: Clean the Data
1. **Clean Real Estate Data**  
   - Run `data_cleaning_real_estate.R`.  

2. **Clean Emissions Data**  
   - Run `data_cleaning_emissions.R`.  

---

## Step 4: Estimate Models
- Run `estimation.R` to estimate models.
- The code is also commented and can be optionally run line by line for better understanding. 
- At the end of the script (lines 695‚Äì705), a summary of **6 models for ATT estimation** will be displayed:

### Models Using Unmatched Samples:
1. `s.model` ‚Äì Simple linear model (mean difference between control and treatment groups).  
2. `model` ‚Äì Multiple log-linear model.

### Models Using Matched Samples (via 3-NN without replacement):
3. `s.model_ad` ‚Äì Simple linear model (mean difference between control and treatment groups).  
4. `model_ad` ‚Äì Multiple log-linear model.

### Models Using Matched Samples (via 3-NN with replacement):
5. `s.model_ad_r` ‚Äì Simple linear model (mean difference between control and treatment groups).  
6. `model_ad_r` ‚Äì Multiple log-linear model.

- **Key Output**:  
  The estimated slope coefficient for the variable `freisetzungen` represents the ATT.  

---

## Step 5: Generate Plots
1. Some plots (e.g., Distributions of Propensity Score ) will be generated by `estimation.R`. Save them manually.  
2. Additional visualizations can be created using:  
   - `cities_map.R` ‚Äì Generates a map of affecting and non-affecting facilities in 2020  
   - `cities_bar_chart.R` ‚Äì Visualizes the distribution of cities across samples.  
   - **Note**: These scripts can be run in any order, but only after `estimation.R`. The plots must also be saved manually.

---

That‚Äôs it! üòä You're all set.
